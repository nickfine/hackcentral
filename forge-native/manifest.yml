app:
  id: ari:cloud:ecosystem::app/f828e0d4-e9d0-451d-b818-533bc3e95680
  runtime:
    name: nodejs22.x

modules:
  confluence:globalPage:
    - key: hackday-central-global-page
      title: HackCentral
      route: hackday-central
      resource: custom-ui-frontend
      resolver:
        function: app-resolver
    - key: hackday-runtime-global-page
      title: HackCentral Runtime (Internal)
      route: hackday-app
      resource: runtime-ui-frontend
      resolver:
        function: runtime-resolver
  macro:
    - key: hackday-central-macro
      title: HackDay Central
      resource: custom-ui-macro
      resolver:
        function: app-resolver
    - key: hackday-runtime-macro
      title: HackCentral Runtime (Internal)
      resource: runtime-ui-frontend
      resolver:
        function: runtime-resolver
      layout: block

  function:
    - key: app-resolver
      handler: index.handler
    - key: runtime-resolver
      handler: runtime/index.handler
    - key: phase5-migration-ops
      handler: ops.handler
    - key: create-from-web
      handler: createFromWeb.handler
  webtrigger:
    - key: phase5-migration-wt
      function: phase5-migration-ops
      response:
        type: dynamic
    - key: hackday-create-from-web
      function: create-from-web
      response:
        type: dynamic

resources:
  - key: custom-ui-frontend
    path: static/frontend/dist
  - key: custom-ui-macro
    path: static/macro-frontend/dist
  - key: runtime-ui-frontend
    path: static/runtime-frontend/dist

permissions:
  scopes:
    - read:confluence-user
    - read:page:confluence
    - write:page:confluence
    - delete:page:confluence
    - read:content.property:confluence
    - write:content.property:confluence
    - read:email-address:confluence
    - storage:app
  content:
    styles:
      - 'unsafe-inline'
  external:
    fetch:
      backend:
        - '*.supabase.co'
        - '*.convex.cloud'
        - '*.atlassian.net'

environment:
  variables:
    - SUPABASE_URL
    - SUPABASE_SERVICE_ROLE_KEY
    - SUPABASE_SCHEMA
    - FORGE_DATA_BACKEND
    - CONVEX_URL
    - CONVEX_FORGE_QUERY
    - CONVEX_FORGE_CREATE_HACK
    - CONVEX_FORGE_CREATE_PROJECT
    - CONVEX_FORGE_UPDATE_MENTOR
    - FORGE_APP_ID
    - FORGE_MACRO_KEY
    - HDC_RUNTIME_OWNER
    - HDC_RUNTIME_APP_ID
    - HDC_RUNTIME_ENVIRONMENT_ID
    - HDC_RUNTIME_MACRO_KEY
    - HACKDAY_TEMPLATE_APP_ID
    - HACKDAY_TEMPLATE_ENVIRONMENT_ID
    - HACKDAY_TEMPLATE_MACRO_KEY
    - CONFLUENCE_HDC_PARENT_PAGE_ID
    - HACKDAY_CREATE_WEB_SECRET
    - HACKDAY_CREATE_APP_URL
